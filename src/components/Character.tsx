/*
Auto-generated by: https://github.com/pmndrs/gltfjsx
*/

import { useSpring, animated } from "@react-spring/three"
import { useEffect, useState } from "react"
import { Gunslinger, GunslingerAnimation } from "../models/Gunslinger"

export enum Target {
  Default,
  A,
  B,
  C,
}

export const Character: React.FC<{ target: Target }> = ({ target }) => {
  const [animation, setAnimation] = useState(GunslingerAnimation.Idle)
  const [deltaZ, setDeltaZ] = useState(0)

  useEffect(() => {
    if (target === Target.Default) {
      return
    }
    start()
  }, [target])

  const start = () => {
    setAnimation(GunslingerAnimation.Run)
    setDeltaZ(6)
  }

  const speed = 0.2

  const { z } = useSpring({
    delay: 0.125 * 0.5 * 1000,
    from: { z: 0 },
    to: { z: deltaZ },
    config: { duration: deltaZ * speed * 1000 },
    onRest() {
      setAnimation(GunslingerAnimation.CrouchIdle)
    },
    onChange(current) {
      if (current.value.z > deltaZ - 1) {
        setAnimation(GunslingerAnimation.Slide)
      }
    },
  })

  return (
    <animated.group position-z={z}>
      <Gunslinger animation={animation} />
    </animated.group>
  )
}
