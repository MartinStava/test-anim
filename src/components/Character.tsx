/*
Auto-generated by: https://github.com/pmndrs/gltfjsx
*/

import {
  useSpring,
  animated,
  useSpringRef,
  useChain,
  AnimationResult,
} from "@react-spring/three"
import { useEffect, useRef, useState } from "react"
import { Gunslinger, GunslingerAnimation } from "../models/Gunslinger"

export enum Target {
  Default,
  A,
  B,
  C,
}

export const Character: React.FC<{ target: Target }> = ({ target }) => {
  const [animation, setAnimation] = useState(GunslingerAnimation.Idle)
  const [deltaZ, setDeltaZ] = useState(0)

  useEffect(() => {
    if (target === Target.Default) {
      return
    }
    start()
  }, [target])

  const start = () => {
    setAnimation(GunslingerAnimation.Run)
    setDeltaZ(5)
  }

  const speed = 0.2

  const pzRef = useSpringRef()
  const { pz } = useSpring({
    delay: 0.25 * 1000 * 0.5 * 0.5,
    from: { pz: 0 },
    to: { pz: deltaZ },
    config: { duration: deltaZ * speed * 1000 },
    onRest() {
      // setAnimation(GunslingerAnimation.Idle)
      setAnimation(GunslingerAnimation.Stop)
    },
    onChange(result: AnimationResult) {
      // if ((result.value as any).pz < deltaZ - 0.5) {
      //   return
      // }
      // setAnimation(GunslingerAnimation.Stop)
    },
    ref: pzRef,
  })

  useChain([pzRef])

  return (
    <animated.group position-z={pz}>
      <Gunslinger animation={animation} />
    </animated.group>
  )
}
